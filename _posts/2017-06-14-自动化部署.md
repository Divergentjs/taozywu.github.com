---
layout:      post
title:       自动化部署
category:    blog
description: 自动化部署
---

## 自动化部署

> 提到自动化部署, 不同人会有不同的想法和解法! 仁者见仁! 不管白猫黑猫,能抓住老鼠就是好猫! 你说呢?

自己一直也想把这个心头病给治了.但是各种原因吧,一直拖着! 最近实在无法忍受了,刚好使劲研究了一翻,发现有些东西其实看明白了没那么复杂,反而豁然开朗!   

## 开发机/测试机/预发布机/生产机/跳板机

* 开发机: 开发者在上面开发的机器
* 测试机: APP童鞋/测试童鞋 调试或测试的机器
* 预发布机: 跟生产机一样的配置 但是用户访问不到的机器
* 生产机: 用户访问的机器
* 跳板机: 简单讲就是A用户要操作B机器,必须先授权进入到C机器,然后在C机器来操作B机器. 我们把C机器就叫跳板机.

## 部署流程

* 先进入到C机器,然后通过git/svn等或其他命令将程序代码拉取过来
* 然后检查并去掉不必要的目录或文件并设置好权限属性.
* 然后通过scp/syrc等命令将代码同步至远程机器并检查权限属性.
* 执行远程机器服务以达到代码生效

## 部分核心脚本代码

* 代码git拉取

```
/usr/local/git/bin/git clone -b master http://用户名:密码@IP/PHP_Work/test.git /data/www/test
```

* 同步

a). ssh避免再次输入密码情况

```
sshpass -p '密码' 命令
```

b). 远程拷贝

```
scp -r [递归] 本地目录 用户@主机:目标目录
```

c). 同步

```
rm -rf /data/www/taozywu/test_1.0.0/.git; rm -f /data/www/taozywu/test_1.0.0/.gitignore;sshpass -p '远程机器密码' scp -r /data/www/taozywu/test_1.0.0/* 远程机器用户名@远程机器IP:/data/www/test/
```

## 重启

a). 远程执行命令

```
ssh -t -p 端口 用户@主机 '命令'
```

b). 重启

```
sshpass -p '远程机器密码' ssh -t -p 22 远程机器用户名@远程机器IP '/usr/sbin/php-fpm'[假如重启php-fpm]
```

## 其他

大家如有好的方案,欢迎一起交流!!
